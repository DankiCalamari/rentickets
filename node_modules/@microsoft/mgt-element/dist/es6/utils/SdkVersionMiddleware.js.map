{"version":3,"file":"SdkVersionMiddleware.js","sourceRoot":"src/","sources":["utils/SdkVersionMiddleware.ts"],"names":[],"mappings":"AAAA;;;;;GAKG;;;;;;;;;;AAGH,OAAO,EACL,gBAAgB,EAChB,gBAAgB,EACjB,MAAM,wEAAwE,CAAC;AAChF,OAAO,EAAE,0BAA0B,EAAE,MAAM,8BAA8B,CAAC;AAC1E,OAAO,EAAE,eAAe,EAAE,MAAM,mBAAmB,CAAC;AAEpD;;;;;;GAMG;AACH,MAAM,OAAO,oBAAoB;IAS/B,YAAY,cAAsB,EAAE,YAAqB;QACvD,IAAI,CAAC,eAAe,GAAG,cAAc,CAAC;QACtC,IAAI,CAAC,aAAa,GAAG,YAAY,CAAC;IACpC,CAAC;IAEY,OAAO,CAAC,OAAgB;;;YACnC,IAAI,CAAC;gBACH,IAAI,OAAO,OAAO,CAAC,OAAO,KAAK,QAAQ,EAAE,CAAC;oBACxC,IAAI,eAAe,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC;wBACrC,sDAAsD;wBACtD,MAAM,WAAW,GAAa,EAAE,CAAC;wBAEjC,MAAM,gBAAgB,GAAG,OAAO,CAAC,iBAAiB,CAAC,oBAAoB,CACrE,0BAA0B,CACG,CAAC;wBAEhC,IAAI,gBAAgB,EAAE,CAAC;4BACrB,MAAM,gBAAgB,GAAG,GAAG,gBAAgB,CAAC,aAAa,IAAI,IAAI,CAAC,eAAe,EAAE,CAAC;4BACrF,WAAW,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;wBACrC,CAAC;wBAED,IAAI,IAAI,CAAC,aAAa,EAAE,CAAC;4BACvB,MAAM,eAAe,GAAG,GAAG,IAAI,CAAC,aAAa,IAAI,IAAI,CAAC,eAAe,EAAE,CAAC;4BACxE,WAAW,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;wBACpC,CAAC;wBAED,kBAAkB;wBAClB,MAAM,cAAc,GAAG,OAAO,IAAI,CAAC,eAAe,EAAE,CAAC;wBACrD,WAAW,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;wBAEjC,mCAAmC;wBACnC,WAAW,CAAC,IAAI,CAAC,gBAAgB,CAAC,OAAO,CAAC,OAAO,EAAE,OAAO,CAAC,OAAO,EAAE,YAAY,CAAC,CAAC,CAAC;wBAEnF,gFAAgF;wBAChF,MAAM,qBAAqB,GAAG,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;wBACrD,gBAAgB,CAAC,OAAO,CAAC,OAAO,EAAE,OAAO,CAAC,OAAO,EAAE,YAAY,EAAE,qBAAqB,CAAC,CAAC;oBAC1F,CAAC;yBAAM,CAAC;wBACN,2DAA2D;wBACpD,MAAA,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,OAAO,+CAAE,OAAO,CAAC,YAAY,CAAC,CAAC;oBACjD,CAAC;gBACH,CAAC;YACH,CAAC;YAAC,OAAO,KAAK,EAAE,CAAC;gBACf,eAAe;YACjB,CAAC;YACD,OAAO,MAAM,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;;KACpD;IAED;;;;;OAKG;IACI,OAAO,CAAC,IAAgB;QAC7B,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;IAC9B,CAAC;CACF","sourcesContent":["/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { Context, Middleware } from '@microsoft/microsoft-graph-client';\nimport {\n  getRequestHeader,\n  setRequestHeader\n} from '@microsoft/microsoft-graph-client/lib/es/src/middleware/MiddlewareUtil';\nimport { ComponentMiddlewareOptions } from './ComponentMiddlewareOptions';\nimport { validateBaseURL } from './validateBaseURL';\n\n/**\n * Implements Middleware for the Graph sdk to inject\n * the toolkit version in the SdkVersion header\n *\n * @class SdkVersionMiddleware\n * @implements {Middleware}\n */\nexport class SdkVersionMiddleware implements Middleware {\n  /**\n   * @private\n   * A member to hold next middleware in the middleware chain\n   */\n  private _nextMiddleware: Middleware;\n  private readonly _packageVersion: string;\n  private readonly _providerName: string;\n\n  constructor(packageVersion: string, providerName?: string) {\n    this._packageVersion = packageVersion;\n    this._providerName = providerName;\n  }\n\n  public async execute(context: Context): Promise<void> {\n    try {\n      if (typeof context.request === 'string') {\n        if (validateBaseURL(context.request)) {\n          // Header parts must follow the format: 'name/version'\n          const headerParts: string[] = [];\n\n          const componentOptions = context.middlewareControl.getMiddlewareOptions(\n            ComponentMiddlewareOptions\n          ) as ComponentMiddlewareOptions;\n\n          if (componentOptions) {\n            const componentVersion = `${componentOptions.componentName}/${this._packageVersion}`;\n            headerParts.push(componentVersion);\n          }\n\n          if (this._providerName) {\n            const providerVersion = `${this._providerName}/${this._packageVersion}`;\n            headerParts.push(providerVersion);\n          }\n\n          // Package version\n          const packageVersion = `mgt/${this._packageVersion}`;\n          headerParts.push(packageVersion);\n\n          // Existing SdkVersion header value\n          headerParts.push(getRequestHeader(context.request, context.options, 'SdkVersion'));\n\n          // Join the header parts together and update the SdkVersion request header value\n          const sdkVersionHeaderValue = headerParts.join(', ');\n          setRequestHeader(context.request, context.options, 'SdkVersion', sdkVersionHeaderValue);\n        } else {\n          // eslint-disable-next-line @typescript-eslint/dot-notation\n          delete context?.options?.headers['SdkVersion'];\n        }\n      }\n    } catch (error) {\n      // ignore error\n    }\n    return await this._nextMiddleware.execute(context);\n  }\n\n  /**\n   * Handles setting of next middleware\n   *\n   * @param {Middleware} next\n   * @memberof SdkVersionMiddleware\n   */\n  public setNext(next: Middleware): void {\n    this._nextMiddleware = next;\n  }\n}\n"]}