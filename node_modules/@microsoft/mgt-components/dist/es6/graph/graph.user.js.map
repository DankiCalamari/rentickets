{"version":3,"file":"graph.user.js","sourceRoot":"src/","sources":["graph/graph.user.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { CacheItem, CacheService, CacheStore, CollectionResponse, IGraph, prepScopes } from '@microsoft/mgt-element';\nimport { User } from '@microsoft/microsoft-graph-types';\n\nimport { GraphRequest } from '@microsoft/microsoft-graph-client';\nimport { schemas } from './cacheStores';\nimport { findPeople, PersonType } from './graph.people';\nimport { IDynamicPerson } from './types';\n\n/**\n * Object to be stored in cache\n */\nexport interface CacheUser extends CacheItem {\n  /**\n   * stringified json representing a user\n   */\n  user?: string;\n}\n\n/**\n * Object to be stored in cache\n */\nexport interface CacheUserQuery extends CacheItem {\n  /**\n   * max number of results the query asks for\n   */\n  maxResults?: number;\n  /**\n   * list of users returned by query\n   */\n  results?: string[];\n}\n\n/**\n * Defines the time it takes for objects in the cache to expire\n */\nexport const getUserInvalidationTime = (): number =>\n  CacheService.config.users.invalidationPeriod || CacheService.config.defaultInvalidationPeriod;\n\n/**\n * Whether or not the cache is enabled\n */\nexport const getIsUsersCacheEnabled = (): boolean =>\n  CacheService.config.users.isEnabled && CacheService.config.isEnabled;\n\nexport const getUsers = async (graph: IGraph, userFilters = '', top = 10): Promise<User[]> => {\n  const allValidScopes = [\n    'User.ReadBasic.All',\n    'User.Read.All',\n    'Directory.Read.All',\n    'User.ReadWrite.All',\n    'Directory.ReadWrite.All'\n  ];\n  const apiString = '/users';\n  let cache: CacheStore<CacheUserQuery>;\n  const cacheKey = `${userFilters === '' ? '*' : userFilters}:${top}`;\n  const cacheItem = { maxResults: top, results: null };\n\n  if (getIsUsersCacheEnabled()) {\n    cache = CacheService.getCache<CacheUserQuery>(schemas.users, schemas.users.stores.userFilters);\n    const cacheRes = await cache.getValue(cacheKey);\n    if (cacheRes && getUserInvalidationTime() > Date.now() - cacheRes.timeCached) {\n      return cacheRes.results.map(userStr => JSON.parse(userStr) as User);\n    }\n  }\n  const graphClient: GraphRequest = graph.api(apiString).top(top);\n\n  if (userFilters) {\n    graphClient.filter(userFilters).header('ConsistencyLevel', 'eventual').count(true);\n  }\n\n  try {\n    const response = (await graphClient\n      .middlewareOptions(prepScopes(allValidScopes))\n      .get()) as CollectionResponse<User>;\n    if (getIsUsersCacheEnabled() && response) {\n      cacheItem.results = response.value.map(userStr => JSON.stringify(userStr));\n      await cache.putValue(userFilters, cacheItem);\n    }\n    return response.value;\n    // eslint-disable-next-line no-empty\n  } catch (error) {}\n};\n\nconst allValidMeScopes = ['User.Read', 'User.ReadWrite'];\n/**\n * async promise, returns Graph User data relating to the user logged in\n *\n * @returns {(Promise<User>)}\n * @memberof Graph\n */\nexport const getMe = async (graph: IGraph, requestedProps?: string[]): Promise<User> => {\n  // for the /me call we'll only use the single User.Read and User.ReadWrite permissions\n  // as they are explicitly scoped to the current user\n  let cache: CacheStore<CacheUser>;\n  if (getIsUsersCacheEnabled()) {\n    cache = CacheService.getCache<CacheUser>(schemas.users, schemas.users.stores.users);\n    const me = await cache.getValue('me');\n\n    if (me && getUserInvalidationTime() > Date.now() - me.timeCached) {\n      const cachedData = JSON.parse(me.user) as User;\n      const uniqueProps = requestedProps\n        ? requestedProps.filter(prop => !Object.keys(cachedData).includes(prop))\n        : null;\n\n      // if requestedProps doesn't contain any unique props other than \"@odata.context\"\n      if (!uniqueProps || uniqueProps.length <= 1) {\n        return cachedData;\n      }\n    }\n  }\n\n  let apiString = 'me';\n  if (requestedProps) {\n    apiString = apiString + '?$select=' + requestedProps.toString();\n  }\n  const response = (await graph.api(apiString).middlewareOptions(prepScopes(allValidMeScopes)).get()) as User;\n  if (getIsUsersCacheEnabled()) {\n    await cache.putValue('me', { user: JSON.stringify(response) });\n  }\n  return response;\n};\n\nexport const validUserByIdScopes = [\n  'User.ReadBasic.All',\n  'User.Read.All',\n  'Directory.Read.All',\n  'User.ReadWrite.All',\n  'Directory.ReadWrite.All'\n];\n/**\n * async promise, returns all Graph users associated with the userPrincipleName provided\n *\n * @param {string} userPrincipleName\n * @returns {(Promise<User>)}\n * @memberof Graph\n */\nexport const getUser = async (graph: IGraph, userPrincipleName: string, requestedProps?: string[]): Promise<User> => {\n  let cache: CacheStore<CacheUser>;\n\n  if (getIsUsersCacheEnabled()) {\n    cache = CacheService.getCache<CacheUser>(schemas.users, schemas.users.stores.users);\n    // check cache\n    const user = await cache.getValue(userPrincipleName);\n\n    // is it stored and is timestamp good?\n    if (user && getUserInvalidationTime() > Date.now() - user.timeCached) {\n      const cachedData = user.user ? (JSON.parse(user.user) as User) : null;\n      const uniqueProps =\n        requestedProps && cachedData ? requestedProps.filter(prop => !Object.keys(cachedData).includes(prop)) : null;\n\n      // return without any worries\n      if (!uniqueProps || uniqueProps.length <= 1) {\n        return cachedData;\n      }\n    }\n  }\n\n  let apiString = `/users/${userPrincipleName}`;\n  if (requestedProps) {\n    apiString = apiString + '?$select=' + requestedProps.toString();\n  }\n\n  // else we must grab it\n  let response: User;\n  try {\n    response = (await graph.api(apiString).middlewareOptions(prepScopes(validUserByIdScopes)).get()) as User;\n    // eslint-disable-next-line no-empty\n  } catch (_) {}\n\n  if (getIsUsersCacheEnabled()) {\n    await cache.putValue(userPrincipleName, { user: JSON.stringify(response) });\n  }\n  return response;\n};\n\n/**\n * Returns a Promise of Graph Users array associated with the user ids array\n *\n * @export\n * @param {IGraph} graph\n * @param {string[]} userIds, an array of string ids\n * @returns {Promise<User[]>}\n */\nexport const getUsersForUserIds = async (\n  graph: IGraph,\n  userIds: string[],\n  searchInput = '',\n  userFilters = '',\n  fallbackDetails?: IDynamicPerson[]\n): Promise<User[]> => {\n  if (!userIds || userIds.length === 0) {\n    return [];\n  }\n  const batch = graph.createBatch<User>();\n  const peopleDict: Record<string, User | Promise<User>> = {};\n  const peopleSearchMatches = {};\n  const notInCache = [];\n  searchInput = searchInput.toLowerCase();\n  let cache: CacheStore<CacheUser>;\n\n  if (getIsUsersCacheEnabled()) {\n    cache = CacheService.getCache<CacheUser>(schemas.users, schemas.users.stores.users);\n  }\n\n  for (const id of userIds) {\n    peopleDict[id] = null;\n    let apiUrl = `/users/${id}`;\n    let user: User;\n    let cacheUser: CacheUser;\n    if (getIsUsersCacheEnabled()) {\n      cacheUser = await cache.getValue(id);\n    }\n    if (cacheUser?.user && getUserInvalidationTime() > Date.now() - cacheUser.timeCached) {\n      user = JSON.parse(cacheUser?.user) as User;\n\n      if (searchInput) {\n        if (user) {\n          const displayName = user.displayName;\n          const searchMatches = displayName?.toLowerCase().includes(searchInput);\n          if (searchMatches) {\n            peopleSearchMatches[id] = user;\n          }\n        }\n      } else {\n        if (user) {\n          peopleDict[id] = user;\n        } else {\n          batch.get(id, apiUrl, validUserByIdScopes);\n          notInCache.push(id);\n        }\n      }\n    } else if (id !== '') {\n      if (id === 'me') {\n        peopleDict[id] = await getMe(graph);\n      } else {\n        apiUrl = `/users/${id}`;\n        if (userFilters) {\n          apiUrl += `${apiUrl}?$filter=${userFilters}&$count=true`;\n        }\n        batch.get(id, apiUrl, validUserByIdScopes, userFilters ? { ConsistencyLevel: 'eventual' } : {});\n        notInCache.push(id);\n      }\n    }\n  }\n  try {\n    if (batch.hasRequests) {\n      const responses = await batch.executeAll();\n      // iterate over userIds to ensure the order of ids\n      for (const id of userIds) {\n        const response = responses.get(id);\n        if (response?.content) {\n          const user = response.content;\n          if (searchInput) {\n            const displayName = user?.displayName.toLowerCase() || '';\n            if (displayName.includes(searchInput)) {\n              peopleSearchMatches[id] = user;\n            }\n          } else {\n            peopleDict[id] = user;\n          }\n\n          if (getIsUsersCacheEnabled()) {\n            await cache.putValue(id, { user: JSON.stringify(user) });\n          }\n        } else {\n          const fallback = fallbackDetails.find(detail => Object.values(detail).includes(id));\n          if (fallback) {\n            peopleDict[id] = fallback as User;\n          }\n        }\n      }\n    }\n    if (searchInput && Object.keys(peopleSearchMatches).length) {\n      return Promise.all(Object.values(peopleSearchMatches));\n    }\n    return Promise.all(Object.values(peopleDict));\n  } catch (_) {\n    // fallback to making the request one by one\n    try {\n      // call getUser for all the users that weren't cached\n      userIds\n        .filter(id => notInCache.includes(id))\n        .forEach(id => {\n          peopleDict[id] = getUser(graph, id);\n        });\n      if (getIsUsersCacheEnabled()) {\n        // store all users that weren't retrieved from the cache, into the cache\n        await Promise.all(\n          userIds\n            .filter(id => notInCache.includes(id))\n            .map(async id => await cache.putValue(id, { user: JSON.stringify(await peopleDict[id]) }))\n        );\n      }\n      return Promise.all(Object.values(peopleDict));\n    } catch (e) {\n      return [];\n    }\n  }\n};\n\n/**\n * Returns a Promise of Graph Users array associated with the people queries array\n *\n * @export\n * @param {IGraph} graph\n * @param {string[]} peopleQueries, an array of string ids\n * @returns {Promise<User[]>}\n */\nexport const getUsersForPeopleQueries = async (\n  graph: IGraph,\n  peopleQueries: string[],\n  fallbackDetails?: IDynamicPerson[]\n): Promise<User[]> => {\n  const allValidPeopleScopes = ['People.Read', 'People.Read.All'];\n  if (!peopleQueries || peopleQueries.length === 0) {\n    return [];\n  }\n\n  const batch = graph.createBatch<CollectionResponse<User>>();\n  const people: User[] = [];\n  let cacheRes: CacheUserQuery;\n  let cache: CacheStore<CacheUserQuery>;\n  if (getIsUsersCacheEnabled()) {\n    cache = CacheService.getCache<CacheUserQuery>(schemas.users, schemas.users.stores.usersQuery);\n  }\n\n  for (const personQuery of peopleQueries) {\n    if (getIsUsersCacheEnabled()) {\n      cacheRes = await cache.getValue(personQuery);\n    }\n\n    if (\n      getIsUsersCacheEnabled() &&\n      cacheRes?.results[0] &&\n      getUserInvalidationTime() > Date.now() - cacheRes.timeCached\n    ) {\n      const person = JSON.parse(cacheRes.results[0]) as User;\n      people.push(person);\n    } else {\n      batch.get(personQuery, `/me/people?$search=\"${personQuery}\"`, allValidPeopleScopes, {\n        'X-PeopleQuery-QuerySources': 'Mailbox,Directory'\n      });\n    }\n  }\n\n  if (batch.hasRequests) {\n    try {\n      const responses = await batch.executeAll();\n\n      for (const personQuery of peopleQueries) {\n        const response = responses.get(personQuery);\n        if (response?.content?.value && response.content.value.length > 0) {\n          people.push(response.content.value[0]);\n          if (getIsUsersCacheEnabled()) {\n            await cache.putValue(personQuery, { maxResults: 1, results: [JSON.stringify(response.content.value[0])] });\n          }\n        } else {\n          const fallback = fallbackDetails.find(detail => Object.values(detail).includes(personQuery));\n          if (fallback) {\n            people.push(fallback as User);\n          }\n        }\n      }\n\n      return people;\n    } catch (_) {\n      try {\n        return Promise.all(\n          peopleQueries\n            .filter(personQuery => personQuery && personQuery !== '')\n            .map(async personQuery => {\n              const personArray = await findPeople(graph, personQuery, 1);\n              if (personArray?.length) {\n                if (getIsUsersCacheEnabled()) {\n                  await cache.putValue(personQuery, { maxResults: 1, results: [JSON.stringify(personArray[0])] });\n                }\n                return personArray[0];\n              }\n            })\n        );\n      } catch (e) {\n        return [];\n      }\n    }\n  }\n  return people;\n};\n\n/**\n * Search Microsoft Graph for Users in the organization\n *\n * @export\n * @param {IGraph} graph\n * @param {string} query - the string to search for\n * @param {number} [top=10] - maximum number of results to return\n * @returns {Promise<User[]>}\n */\nexport const findUsers = async (graph: IGraph, query: string, top = 10, userFilters = ''): Promise<User[]> => {\n  const scopes = validUserByIdScopes;\n  const item = { maxResults: top, results: null };\n  const cacheKey = `${query}:${top}:${userFilters}`;\n  let cache: CacheStore<CacheUserQuery>;\n\n  if (getIsUsersCacheEnabled()) {\n    cache = CacheService.getCache<CacheUserQuery>(schemas.users, schemas.users.stores.usersQuery);\n    const result: CacheUserQuery = await cache.getValue(cacheKey);\n\n    if (result && getUserInvalidationTime() > Date.now() - result.timeCached) {\n      return result.results.map(userStr => JSON.parse(userStr) as User);\n    }\n  }\n\n  const encodedQuery = `${query.replace(/#/g, '%2523')}`;\n  const graphBuilder = graph\n    .api('users')\n    .search(`\"displayName:${encodedQuery}\" OR \"mail:${encodedQuery}\" OR \"userPrincipalName:${encodedQuery}\"`)\n    .header('ConsistencyLevel', 'eventual')\n    .count(true);\n  let graphResult: CollectionResponse<User>;\n\n  if (userFilters !== '') {\n    graphBuilder.filter(userFilters);\n  }\n  try {\n    graphResult = (await graphBuilder.top(top).middlewareOptions(prepScopes(scopes)).get()) as CollectionResponse<User>;\n    // eslint-disable-next-line no-empty\n  } catch {}\n\n  if (getIsUsersCacheEnabled() && graphResult) {\n    item.results = graphResult.value.map(userStr => JSON.stringify(userStr));\n    await cache.putValue(query, item);\n  }\n  return graphResult ? graphResult.value : null;\n};\n\n/**\n * async promise, returns all matching Graph users who are member of the specified group\n *\n * @param {string} query\n * @param {string} groupId - the group to query\n * @param {number} [top=10] - number of people to return\n * @param {PersonType} [personType='person'] - the type of person to search for\n * @param {boolean} [transitive=false] - whether the return should contain a flat list of all nested members\n * @returns {(Promise<User[]>)}\n */\nexport const findGroupMembers = async (\n  graph: IGraph,\n  query: string,\n  groupId: string,\n  top = 10,\n  personType: PersonType = 'person',\n  transitive = false,\n  userFilters = '',\n  peopleFilters = ''\n): Promise<User[]> => {\n  const allValidScopes = [\n    'GroupMember.Read.All',\n    'Group.Read.All',\n    'Directory.Read.All',\n    'GroupMember.ReadWrite.All',\n    'Group.ReadWrite.All'\n  ];\n  const item = { maxResults: top, results: null };\n\n  let cache: CacheStore<CacheUserQuery>;\n  const key = `${groupId || '*'}:${query || '*'}:${top}:${personType}:${transitive}:${userFilters}`;\n\n  if (getIsUsersCacheEnabled()) {\n    cache = CacheService.getCache<CacheUserQuery>(schemas.users, schemas.users.stores.usersQuery);\n    const result: CacheUserQuery = await cache.getValue(key);\n\n    if (result && getUserInvalidationTime() > Date.now() - result.timeCached) {\n      return result.results.map(userStr => JSON.parse(userStr) as User);\n    }\n  }\n\n  let filter = '';\n  if (query) {\n    filter = `startswith(displayName,'${query}') or startswith(givenName,'${query}') or startswith(surname,'${query}') or startswith(mail,'${query}') or startswith(userPrincipalName,'${query}')`;\n  }\n\n  let apiUrl = `/groups/${groupId}/${transitive ? 'transitiveMembers' : 'members'}`;\n  if (personType === 'person') {\n    apiUrl += '/microsoft.graph.user';\n  } else if (personType === 'group') {\n    apiUrl += '/microsoft.graph.group';\n    if (query) {\n      filter = `startswith(displayName,'${query}') or startswith(mail,'${query}')`;\n    }\n  }\n\n  if (userFilters) {\n    filter += query ? ` and ${userFilters}` : userFilters;\n  }\n\n  if (peopleFilters) {\n    filter += query ? ` and ${peopleFilters}` : peopleFilters;\n  }\n\n  const graphClient: GraphRequest = graph.api(apiUrl).top(top).filter(filter);\n\n  if (userFilters || query) {\n    graphClient.header('ConsistencyLevel', 'eventual').count(true);\n  }\n\n  const graphResult = (await graphClient\n    .middlewareOptions(prepScopes(allValidScopes))\n    .get()) as CollectionResponse<User>;\n\n  if (getIsUsersCacheEnabled() && graphResult) {\n    item.results = graphResult.value.map(userStr => JSON.stringify(userStr));\n    await cache.putValue(key, item);\n  }\n\n  return graphResult ? graphResult.value : null;\n};\n\nexport const findUsersFromGroupIds = async (\n  graph: IGraph,\n  query: string,\n  groupIds: string[],\n  top = 10,\n  personType: PersonType = 'person',\n  transitive = false,\n  groupFilters = ''\n): Promise<User[]> => {\n  const users: User[] = [];\n  for (const groupId of groupIds) {\n    try {\n      const groupUsers = await findGroupMembers(graph, query, groupId, top, personType, transitive, groupFilters);\n      users.push(...groupUsers);\n    } catch (_) {\n      continue;\n    }\n  }\n  return users;\n};\n"]}