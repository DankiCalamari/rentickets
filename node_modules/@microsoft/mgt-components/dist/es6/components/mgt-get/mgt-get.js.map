{"version":3,"file":"mgt-get.js","sourceRoot":"src/","sources":["components/mgt-get/mgt-get.ts"],"names":[],"mappings":"AAAA;;;;;GAKG;;;;;;;;;;;;;;;;;;;AAEH,OAAO,EAAE,IAAI,EAAkB,MAAM,KAAK,CAAC;AAC3C,OAAO,EAAE,QAAQ,EAAE,MAAM,mBAAmB,CAAC;AAC7C,OAAO,EACL,YAAY,EAEZ,MAAM,EACN,yBAAyB,EACzB,UAAU,EACV,SAAS,EACT,aAAa,EAGd,MAAM,wBAAwB,CAAC;AAEhC,OAAO,EAAE,mBAAmB,EAAE,MAAM,0BAA0B,CAAC;AAC/D,OAAO,EAAE,oBAAoB,EAAE,MAAM,yBAAyB,CAAC;AAC/D,OAAO,EAAE,OAAO,EAAE,MAAM,yBAAyB,CAAC;AAIlD,OAAO,EAAE,iBAAiB,EAAE,MAAM,wBAAwB,CAAC;AAS3D;;;;;GAKG;AACH,MAAM,CAAC,MAAM,oBAAoB,GAAG,CAAC,KAAc,EAAwC,EAAE,CAC3F,KAAK,CAAC,OAAO,CAAE,KAAqC,aAArC,KAAK,uBAAL,KAAK,CAAkC,KAAK,CAAC,CAAC;AAE/D,MAAM,aAAa,GAAG,CAAC,MAAM,EAAE,OAAO,CAAU,CAAC;AAQjD,MAAM,cAAc,GAAG,CAAC,KAAc,EAAyB,EAAE,CAC/D,OAAO,KAAK,KAAK,QAAQ,IAAI,aAAa,CAAC,QAAQ,CAAC,KAAqB,CAAC,CAAC;AAC7E,MAAM,qBAAqB,GAAG,CAAC,KAAa,EAAE,eAA6B,MAAM,EAAgB,EAAE,CACjG,cAAc,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,YAAY,CAAC;AAE/C;;GAEG;AACH,MAAM,2BAA2B,GAAG,CAAC,yBAAiC,EAAU,EAAE,CAChF,yBAAyB;IACzB,YAAY,CAAC,MAAM,CAAC,QAAQ,CAAC,kBAAkB;IAC/C,YAAY,CAAC,MAAM,CAAC,yBAAyB,CAAC;AAEhD;;GAEG;AACH,MAAM,yBAAyB,GAAG,GAAY,EAAE,CAC9C,YAAY,CAAC,MAAM,CAAC,QAAQ,CAAC,SAAS,IAAI,YAAY,CAAC,MAAM,CAAC,SAAS,CAAC;AAU1E,MAAM,CAAC,MAAM,uBAAuB,GAAG,GAAG,EAAE,CAAC,iBAAiB,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC;AAE9E;;;;;;;;GAQG;AACH,MAAM,OAAO,MAAO,SAAQ,yBAAyB;IAArD;;QAcE;;;;;WAKG;QAQI,WAAM,GAAa,EAAE,CAAC;QAE7B;;;;;WAKG;QAMI,YAAO,GAAG,MAAM,CAAC;QAExB;;;;;;;WAOG;QAOI,SAAI,GAAiB,MAAM,CAAC;QAEnC;;;;;;;WAOG;QAMI,aAAQ,GAAG,CAAC,CAAC;QAEpB;;;;;;WAMG;QAMI,gBAAW,GAAG,CAAC,CAAC;QAEvB;;;;;;WAMG;QAMI,iBAAY,GAAG,KAAK,CAAC;QAE5B;;;;;WAKG;QAKI,4BAAuB,GAAG,CAAC,CAAC;QAmB3B,cAAS,GAAG,KAAK,CAAC;QAClB,iBAAY,GAAG,KAAK,CAAC;QA0CnB,kBAAa,GAAG,GAAG,EAAE;YAC7B,MAAM,OAAO,GAAG,IAAI,CAAC,cAAc,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;YACrD,OAAO,oBAAoB,CAAC,IAAI,CAAC,QAAQ,CAAC;gBACxC,CAAC,CAAC,IAAI,CAAC,qCAAqC,CACxC,IAAI,CAAA,GAAG,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,cAAc,CAAC,OAAO,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,IAAI,OAAO,GAAG,CACzF;gBACH,CAAC,CAAC,OAAO,CAAC;QACd,CAAC,CAAC;QAEF;;;;WAIG;QACO,kBAAa,GAAG,GAAG,EAAE;YAC7B,IAAI,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,IAAI,oBAAoB,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC;gBACrE,MAAM,YAAY,GAAmB,oBAAoB,CAAC,IAAI,CAAC,QAAQ,CAAC;oBACtE,CAAC,CAAC,IAAI,CAAA;YACF,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,cAAc,CAAC,OAAO,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC;SACtE;oBACD,CAAC,CAAC,IAAI,CAAC,cAAc,CAAC,OAAO,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;gBAEhD,OAAO,IAAI,CAAC,qCAAqC,CAAC,YAAY,CAAC,CAAC;YAClE,CAAC;iBAAM,IAAI,IAAI,CAAC,QAAQ,EAAE,CAAC;gBACzB,OAAO,IAAI,CAAC,cAAc,CAAC,SAAS,EAAE,IAAI,CAAC,QAAQ,CAAC,IAAI,IAAI,CAAA,EAAE,CAAC;YACjE,CAAC;iBAAM,IAAI,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC,EAAE,CAAC;gBACvC,OAAO,IAAI,CAAC,cAAc,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;YAC9C,CAAC;iBAAM,CAAC;gBACN,OAAO,IAAI,CAAA,EAAE,CAAC;YAChB,CAAC;QACH,CAAC,CAAC;IA0KJ,CAAC;IAhPC;;;;;;;OAOG;IACI,OAAO,CAAC,WAAW,GAAG,KAAK;QAChC,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;QACzB,IAAI,WAAW,EAAE,CAAC;YAChB,IAAI,CAAC,UAAU,EAAE,CAAC;QACpB,CAAC;QACD,KAAK,IAAI,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;IACxB,CAAC;IAED;;;;;OAKG;IACO,UAAU;QAClB,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;IACvB,CAAC;IAES,IAAI;QACZ,OAAO;YACL,IAAI,CAAC,aAAa;YAClB,IAAI,CAAC,QAAQ;YACb,IAAI,CAAC,MAAM;YACX,IAAI,CAAC,OAAO;YACZ,IAAI,CAAC,WAAW;YAChB,IAAI,CAAC,IAAI;YACT,IAAI,CAAC,QAAQ;YACb,IAAI,CAAC,YAAY;YACjB,IAAI,CAAC,uBAAuB;SAC7B,CAAC;IACJ,CAAC;IAkCO,qCAAqC,CAAC,YAA4B;;QACxE,IAAI,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC,EAAE,CAAC;YAChC,MAAM,cAAc,GAAG,IAAI,CAAC,cAAc,CAAC,SAAS,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;YAErE,uGAAuG;YACvG,IAAI,CAAC,MAAA,MAAA,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,0CAAE,aAAa,mCAAI,GAAG,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC,aAAa,EAAE,CAAC;gBAC9F,OAAO,IAAI,CAAA;YACP,cAAc,GAAG,YAAY;SAChC,CAAC;YACJ,CAAC;iBAAM,CAAC;gBACN,OAAO,IAAI,CAAA;YACP,YAAY,GAAG,cAAc;SAChC,CAAC;YACJ,CAAC;QACH,CAAC;aAAM,CAAC;YACN,OAAO,YAAY,CAAC;QACtB,CAAC;IACH,CAAC;IAED;;;;;;OAMG;IACa,SAAS;;;YACvB,MAAM,QAAQ,GAAG,SAAS,CAAC,cAAc,CAAC;YAE1C,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;YAElB,IAAI,CAAC,QAAQ,IAAI,QAAQ,CAAC,KAAK,KAAK,aAAa,CAAC,QAAQ,EAAE,CAAC;gBAC3D,OAAO;YACT,CAAC;YAED,IAAI,IAAI,CAAC,QAAQ,EAAE,CAAC;gBAClB,IAAI,CAAC;oBACH,IAAI,KAAgC,CAAC;oBACrC,MAAM,GAAG,GAAG,GAAG,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,QAAQ,EAAE,CAAC;oBAC9C,IAAI,QAAQ,GAAqD,IAAI,CAAC;oBAEtE,IAAI,IAAI,CAAC,mBAAmB,EAAE,EAAE,CAAC;wBAC/B,KAAK,GAAG,YAAY,CAAC,QAAQ,CAAgB,OAAO,CAAC,GAAG,EAAE,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;wBACxF,MAAM,MAAM,GAAkB,yBAAyB,EAAE,CAAC,CAAC,CAAC,MAAM,KAAK,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;wBAC7F,IAAI,MAAM,IAAI,2BAA2B,CAAC,IAAI,CAAC,uBAAuB,CAAC,GAAG,IAAI,CAAC,GAAG,EAAE,GAAG,MAAM,CAAC,UAAU,EAAE,CAAC;4BACzG,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,QAAQ,CAA+B,CAAC;wBACvE,CAAC;oBACH,CAAC;oBAED,IAAI,CAAC,QAAQ,EAAE,CAAC;wBACd,IAAI,GAAG,GAAG,IAAI,CAAC,QAAQ,CAAC;wBACxB,IAAI,WAAW,GAAG,KAAK,CAAC;wBAExB,iEAAiE;wBACjE,IAAI,MAAA,IAAI,CAAC,QAAQ,0CAAG,kBAAkB,CAAC,EAAE,CAAC;4BACxC,GAAG,GAAG,IAAI,CAAC,QAAQ,CAAC,kBAAkB,CAAW,CAAC;4BAClD,WAAW,GAAG,IAAI,CAAC;wBACrB,CAAC;6BAAM,CAAC;4BACN,8DAA8D;4BAC9D,WAAW,GAAG,IAAI,GAAG,CAAC,GAAG,EAAE,6BAA6B,CAAC,CAAC,QAAQ,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;wBACvF,CAAC;wBAED,MAAM,KAAK,GAAW,QAAQ,CAAC,KAAK,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC;wBACxD,IAAI,OAAO,GAAiB,KAAK,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;wBAEjE,IAAI,MAAA,IAAI,CAAC,MAAM,0CAAE,MAAM,EAAE,CAAC;4BACxB,OAAO,GAAG,OAAO,CAAC,iBAAiB,CAAC,UAAU,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;wBAC/D,CAAC;wBAED,IAAI,IAAI,CAAC,IAAI,KAAK,MAAM,EAAE,CAAC;4BACzB,QAAQ,GAAG,CAAC,MAAM,OAAO,CAAC,GAAG,EAAE,CAAwC,CAAC;4BAExE,IAAI,WAAW,IAAI,oBAAoB,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,oBAAoB,CAAC,QAAQ,CAAC,EAAE,CAAC;gCACzF,MAAM,cAAc,GAAa,QAAQ,CAAC,KAAK,CAAC;gCAChD,QAAQ,CAAC,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC;4BAC9D,CAAC;4BAED,IAAI,CAAC,IAAI,CAAC,SAAS,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,QAAQ,CAAC,EAAE,CAAC;gCACxD,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;4BAC3B,CAAC;4BAED,wCAAwC;4BACxC,IAAI,oBAAoB,CAAC,QAAQ,CAAC,IAAI,QAAQ,CAAC,iBAAiB,CAAC,EAAE,CAAC;gCAClE,IAAI,SAAS,GAAG,CAAC,CAAC;gCAClB,IAAI,IAAI,GAAG,QAAQ,CAAC;gCAEpB,OACE,CAAC,SAAS,GAAG,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,QAAQ,IAAI,CAAC,IAAI,CAAC,WAAW,IAAI,IAAI,CAAC,WAAW,CAAC,CAAC;qCACtF,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAG,iBAAiB,CAAC,CAAA,EACzB,CAAC;oCACD,SAAS,EAAE,CAAC;oCACZ,MAAM,YAAY,GAAI,IAAI,CAAC,iBAAiB,CAAY,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC;oCAChF,IAAI,GAAG,CAAC,MAAM,KAAK,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,GAAG,EAAE,CAA+B,CAAC;oCACjG,IAAI,MAAA,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,KAAK,0CAAE,MAAM,EAAE,CAAC;wCACxB,IAAI,CAAC,KAAK,GAAG,QAAQ,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;wCAC/C,QAAQ,GAAG,IAAI,CAAC;wCAChB,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC;4CACpB,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;wCAC3B,CAAC;oCACH,CAAC;gCACH,CAAC;4BACH,CAAC;wBACH,CAAC;6BAAM,CAAC;4BACN,IAAI,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,eAAe,CAAC,KAAK,CAAC,CAAC,IAAI,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC;gCAClG,MAAM,IAAI,KAAK,CAAC,sEAAsE,CAAC,CAAC;4BAC1F,CAAC;4BAED,IAAI,KAAa,CAAC;4BAClB,IAAI,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC;gCAChD,8EAA8E;gCAC9E,MAAM,iBAAiB,GAAG,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,eAAe,EAAE,EAAE,CAAC,CAAC;gCACrE,MAAM,aAAa,GAAG,MAAM,mBAAmB,CAAC,KAAK,EAAE,iBAAiB,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;gCACvF,IAAI,aAAa,EAAE,CAAC;oCAClB,KAAK,GAAG,aAAa,CAAC,KAAK,CAAC;gCAC9B,CAAC;4BACH,CAAC;iCAAM,IAAI,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,cAAc,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC;gCACtD,MAAM,aAAa,GAAG,MAAM,oBAAoB,CAAC,KAAK,EAAE,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;gCACpF,IAAI,aAAa,EAAE,CAAC;oCAClB,KAAK,GAAG,aAAa,CAAC,SAAS,CAAC;gCAClC,CAAC;4BACH,CAAC;4BAED,IAAI,KAAK,EAAE,CAAC;gCACV,QAAQ,GAAG;oCACT,KAAK;iCACN,CAAC;4BACJ,CAAC;wBACH,CAAC;wBAED,IAAI,IAAI,CAAC,iBAAiB,EAAE,IAAI,QAAQ,EAAE,CAAC;4BACzC,KAAK,GAAG,YAAY,CAAC,QAAQ,CAAgB,OAAO,CAAC,GAAG,EAAE,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;4BACxF,MAAM,KAAK,CAAC,QAAQ,CAAC,GAAG,EAAE,EAAE,QAAQ,EAAE,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;wBACpE,CAAC;oBACH,CAAC;oBAED,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,QAAQ,CAAC,EAAE,CAAC;wBACrC,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;oBAC3B,CAAC;gBACH,CAAC;gBAAC,OAAO,CAAU,EAAE,CAAC;oBACpB,IAAI,CAAC,KAAK,GAAG,CAAW,CAAC;gBAC3B,CAAC;gBAED,IAAI,IAAI,CAAC,QAAQ,EAAE,CAAC;oBAClB,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;oBAElB,IAAI,IAAI,CAAC,WAAW,EAAE,CAAC;wBACrB,UAAU,CAAC,GAAG,EAAE;4BACd,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;4BACtB,KAAK,IAAI,CAAC,SAAS,EAAE,CAAC,OAAO,CAAC,GAAG,EAAE;gCACjC,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;4BACzB,CAAC,CAAC,CAAC;wBACL,CAAC,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;oBACvB,CAAC;gBACH,CAAC;YACH,CAAC;iBAAM,CAAC;gBACN,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;YACvB,CAAC;YACD,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC;YAC1B,IAAI,CAAC,eAAe,CAAC,YAAY,EAAE,EAAE,QAAQ,EAAE,IAAI,CAAC,QAAQ,EAAE,KAAK,EAAE,IAAI,CAAC,KAAK,EAAE,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC;;KACvG;IAEO,mBAAmB;QACzB,OAAO,yBAAyB,EAAE,IAAI,IAAI,CAAC,YAAY,IAAI,CAAC,CAAC,IAAI,CAAC,YAAY,IAAI,IAAI,CAAC,SAAS,CAAC,CAAC;IACpG,CAAC;IAEO,iBAAiB;QACvB,OAAO,yBAAyB,EAAE,IAAI,IAAI,CAAC,YAAY,CAAC;IAC1D,CAAC;CACF;AAzWQ;IALN,QAAQ,CAAC;QACR,SAAS,EAAE,UAAU;QACrB,OAAO,EAAE,IAAI;QACb,IAAI,EAAE,MAAM;KACb,CAAC;;wCACsB;AAejB;IAPN,QAAQ,CAAC;QACR,SAAS,EAAE,QAAQ;QACnB,SAAS,EAAE,CAAC,KAAK,EAAE,KAAK,EAAE,EAAE;YAC1B,OAAO,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;QACvD,CAAC;QACD,OAAO,EAAE,IAAI;KACd,CAAC;;sCAC2B;AAatB;IALN,QAAQ,CAAC;QACR,SAAS,EAAE,SAAS;QACpB,OAAO,EAAE,IAAI;QACb,IAAI,EAAE,MAAM;KACb,CAAC;;uCACsB;AAgBjB;IANN,QAAQ,CAAC;QACR,SAAS,EAAE,MAAM;QACjB,OAAO,EAAE,IAAI;QACb,IAAI,EAAE,MAAM;QACZ,SAAS,EAAE,KAAK,CAAC,EAAE,CAAC,qBAAqB,CAAC,KAAK,EAAE,MAAM,CAAC;KACzD,CAAC;;oCACiC;AAe5B;IALN,QAAQ,CAAC;QACR,SAAS,EAAE,WAAW;QACtB,OAAO,EAAE,IAAI;QACb,IAAI,EAAE,MAAM;KACb,CAAC;;wCACkB;AAcb;IALN,QAAQ,CAAC;QACR,SAAS,EAAE,cAAc;QACzB,OAAO,EAAE,IAAI;QACb,IAAI,EAAE,MAAM;KACb,CAAC;;2CACqB;AAchB;IALN,QAAQ,CAAC;QACR,SAAS,EAAE,eAAe;QAC1B,OAAO,EAAE,IAAI;QACb,IAAI,EAAE,OAAO;KACd,CAAC;;4CAC0B;AAYrB;IAJN,QAAQ,CAAC;QACR,SAAS,EAAE,2BAA2B;QACtC,IAAI,EAAE,MAAM;KACb,CAAC;;uDACiC;AAQI;IAAtC,QAAQ,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC;;wCAAmE;AAS3D;IAAtC,QAAQ,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC;;qCAAsB","sourcesContent":["/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { html, TemplateResult } from 'lit';\nimport { property } from 'lit/decorators.js';\nimport {\n  CacheService,\n  CacheStore,\n  equals,\n  MgtTemplatedTaskComponent,\n  prepScopes,\n  Providers,\n  ProviderState,\n  CollectionResponse,\n  IGraph\n} from '@microsoft/mgt-element';\n\nimport { getPhotoForResource } from '../../graph/graph.photos';\nimport { getDocumentThumbnail } from '../../graph/graph.files';\nimport { schemas } from '../../graph/cacheStores';\nimport { CacheResponse } from '../CacheResponse';\nimport { Entity } from '@microsoft/microsoft-graph-types';\nimport { GraphRequest } from '@microsoft/microsoft-graph-client';\nimport { registerComponent } from '@microsoft/mgt-element';\n\n/**\n * Simple holder type for an image\n */\ninterface ImageValue {\n  image: string;\n}\n\n/**\n * A type guard to check if a value is a collection response\n *\n * @param value {*} the value to check\n * @returns {boolean} true if the value is a collection response\n */\nexport const isCollectionResponse = (value: unknown): value is CollectionResponse<unknown> =>\n  Array.isArray((value as CollectionResponse<unknown>)?.value);\n\nconst responseTypes = ['json', 'image'] as const;\n/**\n * Enumeration to define what types of query are available\n *\n * @export\n * @enum {string}\n */\nexport type ResponseType = (typeof responseTypes)[number];\nconst isResponseType = (value: unknown): value is ResponseType =>\n  typeof value === 'string' && responseTypes.includes(value as ResponseType);\nconst responseTypeConverter = (value: string, defaultValue: ResponseType = 'json'): ResponseType =>\n  isResponseType(value) ? value : defaultValue;\n\n/**\n * Defines the expiration time\n */\nconst getResponseInvalidationTime = (currentInvalidationPeriod: number): number =>\n  currentInvalidationPeriod ||\n  CacheService.config.response.invalidationPeriod ||\n  CacheService.config.defaultInvalidationPeriod;\n\n/**\n * Whether the response store is enabled\n */\nconst getIsResponseCacheEnabled = (): boolean =>\n  CacheService.config.response.isEnabled && CacheService.config.isEnabled;\n\n/**\n * Holder type emitted with the dataChange event\n */\nexport interface DataChangedDetail {\n  response?: CollectionResponse<Entity>;\n  error?: object;\n}\n\nexport const registerMgtGetComponent = () => registerComponent('get', MgtGet);\n\n/**\n * Custom element for making Microsoft Graph get queries\n *\n * @fires {CustomEvent<DataChangedDetail>} dataChange - Fired when data changes bubbles, composed, and is not cancelable.\n *\n * @export\n * @class mgt-get\n * @extends {MgtTemplatedComponent}\n */\nexport class MgtGet extends MgtTemplatedTaskComponent {\n  /**\n   * The resource to get\n   *\n   * @type {string}\n   * @memberof MgtGet\n   */\n  @property({\n    attribute: 'resource',\n    reflect: true,\n    type: String\n  })\n  public resource: string;\n\n  /**\n   * The scopes to request\n   *\n   * @type {string[]}\n   * @memberof MgtGet\n   */\n  @property({\n    attribute: 'scopes',\n    converter: (value, _type) => {\n      return value ? value.toLowerCase().split(',') : null;\n    },\n    reflect: true\n  })\n  public scopes: string[] = [];\n\n  /**\n   * Api version to use for request\n   *\n   * @type {string}\n   * @memberof MgtGet\n   */\n  @property({\n    attribute: 'version',\n    reflect: true,\n    type: String\n  })\n  public version = 'v1.0';\n\n  /**\n   * Type of response\n   * Default = json\n   * Supported values = json, image\n   *\n   * @type {ResponseType}\n   * @memberof MgtGet\n   */\n  @property({\n    attribute: 'type',\n    reflect: true,\n    type: String,\n    converter: value => responseTypeConverter(value, 'json')\n  })\n  public type: ResponseType = 'json';\n\n  /**\n   * Maximum number of pages to get for the resource\n   * default = 3\n   * if <= 0, all pages will be fetched\n   *\n   * @type {number}\n   * @memberof MgtGet\n   */\n  @property({\n    attribute: 'max-pages',\n    reflect: true,\n    type: Number\n  })\n  public maxPages = 3;\n\n  /**\n   * Number of milliseconds to poll the delta API and\n   * update the response. Set to positive value to enable\n   *\n   * @type {number}\n   * @memberof MgtGet\n   */\n  @property({\n    attribute: 'polling-rate',\n    reflect: true,\n    type: Number\n  })\n  public pollingRate = 0;\n\n  /**\n   * Enables cache on the response from the specified resource\n   * default = false\n   *\n   * @type {boolean}\n   * @memberof MgtGet\n   */\n  @property({\n    attribute: 'cache-enabled',\n    reflect: true,\n    type: Boolean\n  })\n  public cacheEnabled = false;\n\n  /**\n   * Invalidation period of the cache for the responses in milliseconds\n   *\n   * @type {number}\n   * @memberof MgtGet\n   */\n  @property({\n    attribute: 'cache-invalidation-period',\n    type: Number\n  })\n  public cacheInvalidationPeriod = 0;\n\n  /**\n   * Gets or sets the response of the request\n   *\n   * @type any\n   * @memberof MgtGet\n   */\n  @property({ attribute: false }) public response: CollectionResponse<Entity> | Entity | ImageValue;\n\n  /**\n   *\n   * Gets or sets the error (if any) of the request\n   *\n   * @type any\n   * @memberof MgtGet\n   */\n  @property({ attribute: false }) public error: object;\n\n  private isPolling = false;\n  private isRefreshing = false;\n\n  /**\n   * Refresh the data\n   *\n   * @param {boolean} [hardRefresh=false]\n   * if false (default), the component will only update if the data changed\n   * if true, the data will be first cleared and reloaded completely\n   * @memberof MgtGet\n   */\n  public refresh(hardRefresh = false) {\n    this.isRefreshing = true;\n    if (hardRefresh) {\n      this.clearState();\n    }\n    void this._task.run();\n  }\n\n  /**\n   * Clears state of the component\n   *\n   * @protected\n   * @memberof MgtGet\n   */\n  protected clearState(): void {\n    this.response = null;\n  }\n\n  protected args(): unknown[] {\n    return [\n      this.providerState,\n      this.resource,\n      this.scopes,\n      this.version,\n      this.pollingRate,\n      this.type,\n      this.maxPages,\n      this.cacheEnabled,\n      this.cacheInvalidationPeriod\n    ];\n  }\n\n  protected renderLoading = () => {\n    const loading = this.renderTemplate('loading', null);\n    return isCollectionResponse(this.response)\n      ? this.renderValueContentWithDefaultTemplate(\n          html`${this.response.value.map(v => this.renderTemplate('value', v, v.id))} ${loading} `\n        )\n      : loading;\n  };\n\n  /**\n   * Invoked on each update to perform rendering tasks. This method must return\n   * a lit-html TemplateResult. Setting properties inside this method will *not*\n   * trigger the element to update.\n   */\n  protected renderContent = () => {\n    if (this.hasTemplate('value') && isCollectionResponse(this.response)) {\n      const valueContent: TemplateResult = isCollectionResponse(this.response)\n        ? html`\n          ${this.response.value.map(v => this.renderTemplate('value', v, v.id))}\n        `\n        : this.renderTemplate('value', this.response);\n\n      return this.renderValueContentWithDefaultTemplate(valueContent);\n    } else if (this.response) {\n      return this.renderTemplate('default', this.response) || html``;\n    } else if (this.hasTemplate('no-data')) {\n      return this.renderTemplate('no-data', null);\n    } else {\n      return html``;\n    }\n  };\n\n  private renderValueContentWithDefaultTemplate(valueContent: TemplateResult) {\n    if (this.hasTemplate('default')) {\n      const defaultContent = this.renderTemplate('default', this.response);\n\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/dot-notation\n      if ((this.templates['value']?.templateOrder ?? 999) > this.templates['default'].templateOrder) {\n        return html`\n          ${defaultContent}${valueContent}\n        `;\n      } else {\n        return html`\n          ${valueContent}${defaultContent}\n        `;\n      }\n    } else {\n      return valueContent;\n    }\n  }\n\n  /**\n   * load state into the component.\n   *\n   * @protected\n   * @returns\n   * @memberof MgtGet\n   */\n  protected async loadState() {\n    const provider = Providers.globalProvider;\n\n    this.error = null;\n\n    if (!provider || provider.state !== ProviderState.SignedIn) {\n      return;\n    }\n\n    if (this.resource) {\n      try {\n        let cache: CacheStore<CacheResponse>;\n        const key = `${this.version}${this.resource}`;\n        let response: Entity | CollectionResponse<Entity> | ImageValue = null;\n\n        if (this.shouldRetrieveCache()) {\n          cache = CacheService.getCache<CacheResponse>(schemas.get, schemas.get.stores.responses);\n          const result: CacheResponse = getIsResponseCacheEnabled() ? await cache.getValue(key) : null;\n          if (result && getResponseInvalidationTime(this.cacheInvalidationPeriod) > Date.now() - result.timeCached) {\n            response = JSON.parse(result.response) as CollectionResponse<Entity>;\n          }\n        }\n\n        if (!response) {\n          let uri = this.resource;\n          let isDeltaLink = false;\n\n          // if we had a response earlier with a delta link, use it instead\n          if (this.response?.['@odata.deltaLink']) {\n            uri = this.response['@odata.deltaLink'] as string;\n            isDeltaLink = true;\n          } else {\n            // TODO: Check this against the base url for the cloud in use.\n            isDeltaLink = new URL(uri, 'https://graph.microsoft.com').pathname.endsWith('delta');\n          }\n\n          const graph: IGraph = provider.graph.forComponent(this);\n          let request: GraphRequest = graph.api(uri).version(this.version);\n\n          if (this.scopes?.length) {\n            request = request.middlewareOptions(prepScopes(this.scopes));\n          }\n\n          if (this.type === 'json') {\n            response = (await request.get()) as CollectionResponse<Entity> | Entity;\n\n            if (isDeltaLink && isCollectionResponse(this.response) && isCollectionResponse(response)) {\n              const responseValues: Entity[] = response.value;\n              response.value = this.response.value.concat(responseValues);\n            }\n\n            if (!this.isPolling && !equals(this.response, response)) {\n              this.response = response;\n            }\n\n            // get more pages if there are available\n            if (isCollectionResponse(response) && response['@odata.nextLink']) {\n              let pageCount = 1;\n              let page = response;\n\n              while (\n                (pageCount < this.maxPages || this.maxPages <= 0 || (isDeltaLink && this.pollingRate)) &&\n                page?.['@odata.nextLink']\n              ) {\n                pageCount++;\n                const nextResource = (page['@odata.nextLink'] as string).split(this.version)[1];\n                page = (await graph.api(nextResource).version(this.version).get()) as CollectionResponse<Entity>;\n                if (page?.value?.length) {\n                  page.value = response.value.concat(page.value);\n                  response = page;\n                  if (!this.isPolling) {\n                    this.response = response;\n                  }\n                }\n              }\n            }\n          } else {\n            if (this.resource.indexOf('/photo/$value') === -1 && this.resource.indexOf('/thumbnails/') === -1) {\n              throw new Error('Only /photo/$value and /thumbnails/ endpoints support the image type');\n            }\n\n            let image: string;\n            if (this.resource.indexOf('/photo/$value') > -1) {\n              // Sanitizing the resource to ensure getPhotoForResource gets the right format\n              const sanitizedResource = this.resource.replace('/photo/$value', '');\n              const photoResponse = await getPhotoForResource(graph, sanitizedResource, this.scopes);\n              if (photoResponse) {\n                image = photoResponse.photo;\n              }\n            } else if (this.resource.indexOf('/thumbnails/') > -1) {\n              const imageResponse = await getDocumentThumbnail(graph, this.resource, this.scopes);\n              if (imageResponse) {\n                image = imageResponse.thumbnail;\n              }\n            }\n\n            if (image) {\n              response = {\n                image\n              };\n            }\n          }\n\n          if (this.shouldUpdateCache() && response) {\n            cache = CacheService.getCache<CacheResponse>(schemas.get, schemas.get.stores.responses);\n            await cache.putValue(key, { response: JSON.stringify(response) });\n          }\n        }\n\n        if (!equals(this.response, response)) {\n          this.response = response;\n        }\n      } catch (e: unknown) {\n        this.error = e as object;\n      }\n\n      if (this.response) {\n        this.error = null;\n\n        if (this.pollingRate) {\n          setTimeout(() => {\n            this.isPolling = true;\n            void this.loadState().finally(() => {\n              this.isPolling = false;\n            });\n          }, this.pollingRate);\n        }\n      }\n    } else {\n      this.response = null;\n    }\n    this.isRefreshing = false;\n    this.fireCustomEvent('dataChange', { response: this.response, error: this.error }, true, false, true);\n  }\n\n  private shouldRetrieveCache(): boolean {\n    return getIsResponseCacheEnabled() && this.cacheEnabled && !(this.isRefreshing || this.isPolling);\n  }\n\n  private shouldUpdateCache(): boolean {\n    return getIsResponseCacheEnabled() && this.cacheEnabled;\n  }\n}\n"]}